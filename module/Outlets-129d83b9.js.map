{"version":3,"file":"Outlets-129d83b9.js","sources":["../../src/OutletView.html","../../src/Outlets.html"],"sourcesContent":["<script>\n  import { onMount } from 'svelte';\n  import Toolbar from './UI/UIToolbar.html'\n  import TextField from './UI/UITextField.html';\n  import UIItem from './UI/UIItem.html';\n  import ModalView from './UI/UIModalView.html'\n  import Loading from './UI/UILoading.html'\n  import { session, api, alert, accounts, modal, selected_obj, customers, pop_modal, fetch } from './CTStore.js';\n  export let outlet = {}, acc_id = \"\";\n  let intervals = [45, 30, 15, 10, 5], interval = 30, start_time = [8, 0], end_time = [23, 30];\n  let tool_style = { container: \"justify-end\" }\n  let tools = [{ name: \"Close\", icon: \"close-circle\", function: \"pop_modal\" },\n  { name: \"Save\", icon: \"checkmark-circle\", function: \"save\" }]\n  let loading = true, list = [];\n  if (!outlet.phone) {\n    outlet.phone = \"\"\n  }\n  if (outlet.location && outlet.location.coordinates && outlet.location.coordinates.length > 1) {\n    outlet.coordinates = `${outlet.location.coordinates[1]},${outlet.location.coordinates[0]}`\n  } else {\n    outlet.coordinates = \"\";\n  }\n  if (!outlet.timeslots) outlet.timeslots = []\n  refresh()\n  let field_style = { container: \"p-2 w-1/2 flex-none mb-2\", label: \"w-32\" }\n  function refresh() {\n    fetch(api(`/devices/${acc_id}/${outlet.id}`)).then(r => {\n      list = r;\n      loading = false;\n    });\n  }\n\n  function add() {\n    loading = true;\n    fetch(api(`/devices/${acc_id}/${outlet.id}`), {}).then(r => { refresh(); });\n  }\n\n  function tf_disp(t) {\n    var ta = t.split(':'), am = 'AM'\n    var hr = parseInt(ta)\n    if (hr > 12) {\n      hr -= 12\n      am = 'PM'\n    }\n    return `${hr}:${ta[1]}${am}`\n  }\n  function tf(t) {\n    var min = `${t[1]}`\n    if (t[1] < 10) min = `0${min}`\n    return `${t[0]}:${min}`\n  }\n  function removeSlot(slot) {\n    outlet.timeslots = outlet.timeslots.filter(t => t != slot);\n  }\n  function resetSlots(interval) {\n    var time = start_time.slice()\n    let slots = [tf(time)]\n    for (var i = 1; i < 60; i++) {\n      if (time[0] >= end_time[0] && time[1] >= end_time[1]) break;\n      time[1] += interval\n      if (time[1] >= 60) {\n        time[0] += 1\n        time[1] = time[1] - 60\n      }\n      slots = [...slots, tf(time)]\n    }\n    outlet.timeslots = slots;\n  }\n\n  function selected(e) {\n    if (e.detail.function == 'pop_modal') {\n      pop_modal()\n    }\n    if (e.detail.function == 'save') {\n      loading = true;\n      fetch(api(`/outlet`), { _id: outlet._id, phone: outlet.phone, address: outlet.address, \"address2\": outlet.address2, \"postcode\": outlet.postcode, \"coordinates\": outlet.coordinates, \"timeslots\": outlet.timeslots }).then(r => { loading = false; $accounts = r; });\n    }\n  }\n  let style = { content: 'overflow-y-scroll scrolling-touch' }\n</script>\n<ModalView style=\"{style}\">\n  <div slot=\"loader\">\n    {#if loading}\n  <Loading>\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n    {/if}\n  </div>\n  <div slot=\"title\" class=\"text-center font-semibold text-2xl text-gray-600 m-2 flex\">\n    {outlet.name}\n  </div>\n  <div slot=\"content\" class=\"p-2 overflow-y-auto\">\n      <p class=\"text-lg m-2 font-semibold text-gray-600\"><i class=\"icon ion-md-alert\"></i> Outlet Info</p>\n      <TextField style=\"{field_style}\" label=\"Phone Number\" bind:value=\"{outlet.phone}\" />\n      <TextField style=\"{field_style}\" label=\"Address\" bind:value=\"{outlet.address}\" />\n      <TextField style=\"{field_style}\" label=\"Address 2\" bind:value=\"{outlet.address2}\" />\n      <TextField style=\"{field_style}\" label=\"Postcode\" bind:value=\"{outlet.postcode}\" />\n      <TextField style=\"{field_style}\" label=\"Coordinates\" placeholder=\"3.123123,4.123231\" bind:value=\"{outlet.coordinates}\" />\n      <p class=\"text-xs px-3 mb-3 font-semibold\">\n        Ensure that the details above is correct, as price estimation and riders depend on the accuracy of this information.\n      </p>\n      <div class=\"px-2\">\n        <label class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2 {field_style.label}\">Time\n          Slots</label>\n        <div class=\"border rounded shadow-sm p-2 w-full flex flex-wrap mb-2\">\n          {#if outlet.timeslots.length > 0}\n              {#each outlet.timeslots as timeslot}\n              <span class=\"inline-block p-2 rounded-lg text-xs bg-theme text-white m-1\" on:click=\"{ () => removeSlot(timeslot) }\">{tf_disp(timeslot)}<i class=\"icon ion-md-close pl-2 font-semibold\"></i></span>\n              {/each}\n              {:else}\n              <p class=\"text-gray-500 cursor-pointer\" on:click=\"{ () => resetSlots(interval) }\">No Time Slots Specified. Tap To Add Time Slots.</p>\n            {/if}\n        </div>\n        {#if outlet.timeslots.length > 0}\n        <button on:click=\"{ () => outlet.timeslots = [] }\" class=\"p-1 px-2 bg-theme rounded-lg text-sm text-white mr-2\">Clear</button>\n        <button on:click=\"{ () => resetSlots(interval) }\" class=\"p-1 px-2 bg-theme rounded-lg text-sm text-white mr-2\">Reset</button>\n        <select bind:value=\"{interval}\" on:change=\"{ () => resetSlots(interval) }\">\n          {#each intervals as itv}\n          <option value=\"{itv}\">{itv} minutes</option>\n          {/each}\n        </select>\n        {/if}\n      </div>\n      <p class=\"text-lg m-2 font-semibold text-gray-600\"><i class=\"icon ion-md-tablet-portrait\"></i> Devices</p>\n\n{#each list as device}\n<UIItem>\n  <div class=\"flex-1 px-4 py-2 m-2\">\n    {device.code}\n  </div>\n</UIItem>\n{/each}\n      <div class=\"rounded-lg cursor-pointer border border-dashed border-gray-300 m-2 p-2 text-gray-500 bounce h-12 flex\" on:click=\"{add}\">\n        <div class=\"flex-grow self-center\"><i class=\"icon ion-md-add\"></i> Add New Device</div>\n      </div>\n\n  </div>\n  <div slot=\"toolbar\">\n    <Toolbar on:selected=\"{selected}\" tools=\"{tools}\" style=\"{tool_style}\" />\n  </div>\n</ModalView>","<script>\n  import Toolbar from './UI/UIToolbar.html';\n  import UIItem from './UI/UIItem.html';\n  import LoadingView from './UI/UILoading.html';\n  import OutletView from './OutletView.html';\n  import { onMount } from 'svelte';\n  import { session, api, fetch, trigger, modal, uuid, loading } from './CTStore.js';\n  let current_sync, sync = false, accounts;\n  let tools = [{ name: \"Refresh\", icon: \"refresh\", function: \"refresh\" }]\n  function selected(e) {\n    switch (e.detail.function) {\n      case \"refresh\":\n        {\n          if (sync == false) refresh(0, 0)\n        }\n        break;\n    }\n  }\n  function refresh(acc, outlet) {\n    sync = true;\n    let outlet_id = accounts[acc].outlets[outlet].id;\n    current_sync = outlet_id;\n    fetch(api('/accounts/refresh'),{ outlet_id }).then(o => {\n      if (outlet + 1 == accounts[acc].outlets.length) {\n        if (acc + 1 < accounts.length) {\n          refresh(acc + 1, 0);\n        } else {\n          current_sync = \"\"; sync = false;\n        }\n      } else {\n        refresh(acc, outlet + 1);\n      }\n    });\n  }\n  function toggle(outlet_id, app_hidden) {\n    $loading = true;\n    fetch(api(`/outlet`), { _id: outlet_id, app_hidden: (app_hidden == 'true') })\n      .then(r => { $loading = false; accounts = r; });\n  }\n  fetch(api('/accounts')).then(o => { accounts = o })\n</script>\n<style>\n  .toggle {\n    @apply w-10 text-center self-center;\n  }\n</style>\n<Toolbar class=\"border-b border-gray-300\" on:selected=\"{selected}\" tools=\"{tools}\" />\n{#if !accounts}\n  <LoadingView type=\"h-64\">\n    <div slot=\"message\">\n      Retrieving Outlets..\n    </div>\n  </LoadingView>\n{:else}\n{#if accounts[0].outlets.length==0}\n<LoadingView type=\"h-64\" spinner=\"false\">\n  <div slot=\"message\">\n    No outlets configured.\n  </div>\n</LoadingView>\n{:else}\n{#each accounts as acc}\n{#each acc.outlets as outlet, i}\n<UIItem>\n    <i class=\"toggle fas { outlet.app_hidden ? 'fa-eye-slash' : 'fa-eye' }\"\n      on:click=\"{ () => toggle(outlet._id, outlet.app_hidden ? 'false' : 'true') }\"></i>\n  <div class=\"flex-1 p-2 m-2\" on:click=\"{ () => { $modal = [...$modal, { outlet, index : i, acc_id : acc._id, view : OutletView }];} }\">\n    {outlet.name}\n  </div>\n  {#if current_sync==outlet.id}\n  <span class=\"inline-block px-4 py-2 m-2 flex-none\">\n    <i class=\"fas fa-sync fa-spin\"></i>\n  </span>\n  {/if}\n</UIItem>\n{/each}\n{/each}\n{/if}\n{/if}"],"names":["ctx","name","timeslots","length","tf_disp","code","phone","address","address2","postcode","coordinates","label","t","ta","split","am","hr","parseInt","tf","min","outlet","acc_id","intervals","interval","start_time","end_time","loading","list","location","refresh","fetch","api","id","then","r","removeSlot","slot","filter","resetSlots","time","slice","slots","i","container","icon","function","e","detail","pop_modal","_id","$accounts","content","timeslot","app_hidden","outlets","current_sync","accounts","sync","acc","outlet_id","o","toggle","$loading","$modal","index","view","OutletView"],"mappings":"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"}