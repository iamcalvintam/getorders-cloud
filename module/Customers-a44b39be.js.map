{"version":3,"file":"Customers-a44b39be.js","sources":["../../src/CustomerView.html","../../src/CustomerImport.html","../../src/Customers.html"],"sourcesContent":["<script>\n  import { onMount } from 'svelte';\n  import Toolbar from './UI/UIToolbar.html'\n  import ModalView from './UI/UIModalView.html'\n  import Loading from './UI/UILoading.html'\n  import { session, api, alert, accounts, modal, selected_obj, headers, customers, pop_modal } from './CTStore.js';\n  let loading = false, dob = \"\", list;\n  export let customer = {}\n  dob = customer.DOB ? new Date(customer.DOB).toJSON().slice(0,10) : ''\n  onMount( ()=> {\n      fetch(api(`/loyalty/list/history/${customer._id}`),headers()).then(r => r.json()).then(r => {\n        list = r\n        console.log(list)\n      })\n  })\n  let tool_style = { container : \"justify-end\"}\n  let tools = [{ name : \"Close\", icon : \"close-circle\", function : \"pop_modal\"},\n               { name : \"Save\", icon : \"checkmark-circle\", function : \"save\"}]\n  function selected(e){\n    if(e.detail.function=='pop_modal'){\n      pop_modal()\n    }\n    if(e.detail.function=='save'){\n      loading = true;\n      customer.DOB = dob;\n      fetch(api(`/loyalty/edit`),headers(customer)).then(r => { loading = false; $customers = $customers.map(r => r._id==customer._id ? customer : r) });\n    }\n  }\n</script>\n<ModalView>\n  <div slot=\"loader\">\n      {#if loading}\n  <Loading>\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n    {/if}\n  </div>\n  <div slot=\"title\" class=\"font-semibold text-xl text-gray-600 pb-3\">\n    Customer\n  </div>\n  <div slot=\"content\">\n\n<div class=\"flex mb-2\">\n    <div class=\"w-1/2 flex mx-2 border-b\">\n        <label class=\"flex-none w-20 self-center text-xs uppercase text-gray-500 font-semibold\">First Name</label>\n        <input class=\"flex-grow pl-2 focus:outline-none\" type=\"text\" placeholder=\"First Name\" bind:value=\"{customer.firstName}\" />\n    </div>\n    <div class=\"w-1/2 flex mx-2 border-b\">\n        <label class=\"flex-none w-20 self-center text-xs uppercase text-gray-500 font-semibold\">Last Name</label>\n        <input class=\"flex-grow pl-2 focus:outline-none\" type=\"text\" placeholder=\"Last Name\" bind:value=\"{customer.lastName}\" />\n    </div>\n</div>\n<div class=\"flex my-3\">\n    <div class=\"w-1/2 flex mx-2 border-b\">\n        <label class=\"flex-none w-20 self-center text-xs uppercase text-gray-500 font-semibold\">Email</label>\n        <input class=\"flex-grow pl-2 focus:outline-none\" type=\"email\" placeholder=\"Email\" bind:value=\"{customer.Email}\" />\n    </div>\n    <div class=\"w-1/2 flex mx-2 border-b\">\n        <label class=\"flex-none w-20 self-center text-xs uppercase text-gray-500 font-semibold\">Phone</label>\n        <input class=\"flex-grow pl-2 focus:outline-none\" type=\"phone\" placeholder=\"Phone\" bind:value=\"{customer.Phone}\" />\n    </div>\n</div>\n<div class=\"flex mb-6\">\n    <div class=\"w-1/2 flex border rounded mx-3 shadow overflow-hidden\">\n      <div class=\"flex-none m-2\">\n        <label class=\"block text-gray-600 text-xs uppercase text-gray-500 font-semibold mb-2\">Birthday</label>\n        <input class=\"w-32 focus:outline-none\" type=\"text\" placeholder=\"YYYY-MM-DD\" bind:value=\"{dob}\" />\n      </div>\n      <div class=\"flex-grow m-2\">\n        <label class=\"block text-gray-600 text-xs uppercase text-gray-500 font-semibold mb-2\">Gender</label>\n<div class=\"inline-flex px-3 pb-3\">\n  <button on:click=\"{ () => customer.Gender = 'M' }\" class=\"bg-gray-{ customer.Gender=='M' ? '600' : '100'} hover:bg-gray-400 text-gray-{ customer.Gender=='M' ? '100' : '400'} font-bold py-2 px-4 rounded-l\">\n    Male\n  </button>\n  <button on:click=\"{ () => customer.Gender = 'F' }\" class=\"bg-gray-{ customer.Gender=='F' ? '600' : '100'} hover:bg-gray-400 text-gray-{ customer.Gender=='F' ? '100' : '400'} font-bold py-2 px-4 rounded-r\">\n    Female\n  </button>\n</div>\n\n      </div>\n    </div>\n    <div class=\"w-1/2 relative border rounded mx-3 px-2 shadow appearance-none\">\n      <label class=\"block text-gray-600 text-xs uppercase text-gray-500 font-semibold my-2\">Notes</label>\n      <textarea class=\"p-2 w-full\" bind:value=\"{customer.Notes}\"></textarea>\n    </div>\n</div>\n  <p class=\"text-lg m-2 font-semibold text-gray-600\"> History</p>\n  <div class=\"p-2 h-32 overflow-scroll-y\">\n{#if !list}\n  <i class=\"fa fa-spin fa-cog\" id=\"loading-icon\"></i>\n    <p>\n      Retrieving Records..\n  </p>\n  {:else if list.length==0}\n  <p class=\"text-center\">\n    No Records Found.\n  </p>\n  {:else}\n    <div class=\"flex font-semibold\">\n      <div class=\"w-1/5 border-b\">Time</div>\n      <div class=\"w-2/5 border-b\">Description</div>\n      <div class=\"w-1/5 border-b text-green-500 text-center\">Debit</div>\n      <div class=\"w-1/5 border-b text-red-500 text-center\">Credit</div>\n    </div>\n    {#each list as record}\n  <div class=\"flex border-b\">\n  <div class=\"w-1/5\">\n    <p>\n      {@html record.date ? record.date.replace(\"\\n\",\"<br>\") : ''}\n    </p>\n    </div>\n  <div class=\"w-2/5\">\n    <p>\n      {record.Source}\n    </p>\n  </div>\n  <div class=\"w-1/5 text-green-500 text-center\"><p>\n    {record.Amount>record.AmountBefore ? record.Amount-record.AmountBefore : ''}\n    </p></div>\n  <div class=\"w-1/5 text-red-500 text-center\"><p>\n    {record.AmountBefore>record.Amount ? record.AmountBefore-record.Amount : ''}\n    </p></div>\n</div>\n  {/each}\n  {/if}\n  </div>\n  \n  </div>\n    <div slot=\"toolbar\">\n    <Toolbar on:selected=\"{selected}\" tools=\"{tools}\" style=\"{tool_style}\" />\n  </div>\n</ModalView>","<svelte:head>\n  <script src=\"https://unpkg.com/papaparse@latest/papaparse.min.js\"></script>\n</svelte:head>\n<script>\n  import { createEventDispatcher } from 'svelte';\n  import Toolbar from './UI/UIToolbar.html'\n\tconst dispatch = createEventDispatcher();\n  import Loading from './UI/UILoading.html'\n  import ModalView from './UI/UIModalView.html'\n  import { modal, uuid, api, headers, pop_modal} from './CTStore.js';\n  let source, loading = false, file_content = \"\", reader = new FileReader();\n  let tools = [{ name : \"Close\", icon : \"close-circle\", function : \"pop_modal\"},\n               { name : \"Save\", icon : \"checkmark-circle\", function : \"save\"}]\n  function readFile() {\n    reader.onload = ()=> { file_content = reader.result  };\n    reader.readAsBinaryString(source.files[0]);\n  }\n  function chunk (arr, len) {\n\n  var chunks = [],\n      i = 0,\n      n = arr.length;\n\n  while (i < n) {\n    chunks.push(arr.slice(i, i += len));\n  }\n\n  return chunks;\n}\n  function selected(e){\n    if(e.detail.function=='pop_modal'){\n      pop_modal()\n    }\n    if(e.detail.function=='save' && file_content!=\"\"){\n       //Parse CSV\n        let result = Papa.parse(file_content, {header : true})\n        loading = true;\n      let cust_list = result.data;\n      //Send by each 200\n      let chunks = chunk(cust_list,200)\n      send(chunks)\n    }\n  }\n  function send(chunk){\n    var list = chunk.shift();\n    fetch(api('/loyalty/import'),headers(list)).then(r => r.json()).then(r => {\n          \n            console.log('Done : '+chunk.length);\n            if(chunk.length==0){\n              pop_modal()\n            } else {\n              send(chunk)\n            }\n        });\n  }\n  let style = { body : \"screen-height-xs\", toolbar : \"text-white p-2\"}\n</script>\n<ModalView style=\"{style}\">\n  <div slot=\"loader\">\n      {#if loading}\n  <Loading>\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n    {/if}\n  </div>\n  <div slot=\"title\" class=\"font-semibold text-xl text-gray-600\">\n    Upload CSV\n  </div>\n  <div slot=\"content\">\n<div class=\"shadow-lg p-2\">\n  <div class=\"text-sm text-gray-500 font-semibold\">Select CSV File</div>\n  <label class=\"m-2 p-2 block rounded-lg cursor-pointer bounce border-2 border-blue-400 { file_content==\"\" ? 'text-blue-400' : 'bg-blue-400 text-white'}\">\n    {#if file_content==\"\"}\n      <i class=\"icon ion-md-cloud-upload px-1\"></i>\n        <span class=\"mt-2 text-base leading-normal\">Upload CSV File</span>\n    {:else}\n    <i class=\"icon ion-md-cloud-done px-1\"></i>\n        <span class=\"mt-2 text-base leading-normal\">File selected</span>\n    {/if}\n        <input type=\"file\" class=\"hidden\" bind:this=\"{source}\" on:change=\"{readFile}\"/>\n    </label>\n</div>\n  </div>\n  <div slot=\"toolbar\">\n    <Toolbar on:selected=\"{selected}\" tools=\"{tools}\" />\n  </div>\n</ModalView>","<svelte:head>\n  <script src=\"https://unpkg.com/papaparse@latest/papaparse.min.js\"></script>\n</svelte:head>\n<script>\n  import { onMount } from 'svelte';\n  import UIItem from './UI/UIItem.html';\n  import Toolbar from './UI/UIToolbar.html';\n  import CustomerView from './CustomerView.html';\n  import CustomerImport from './CustomerImport.html';\n  import { session, api, alert, accounts, modal, selected_obj, headers, customers, clean, download, loading } from './CTStore.js';\n  let query = \"\"; $customers = undefined;\n  let tools = [{ name: \"Export\", icon: \"cloud-download\", function: \"export\" },\n  { name: \"Import\", icon: \"cloud-upload\", function: \"import\" }]\n  function searchNumber() {\n    $loading = true; $customers = undefined;\n    fetch(api(`/loyalty/list/${query}`), headers()).then(r => { $loading = false; return r.json() }).then(r => $customers = r);\n  }\n  function inspect(c) {\n    $modal = [...$modal, { customer: c, view: CustomerView }]\n  }\n  function selected(e) {\n    switch (e.detail.function) {\n      case \"import\":\n        $modal = [...$modal, { view: CustomerImport }]\n        break;\n      case \"export\":\n        {\n          let custs = $customers.map(r => clean(r, [\"Email\", \"DOB\", \"firstName\", \"lastName\", \"Points\", \"Phone\"]))\n          download(Papa.unparse(custs), 'customers.csv', 'text/csv;encoding:utf-8');\n        }\n        break;\n    }\n  }\n</script>\n<Toolbar class=\"border-b border-gray-300\" on:selected=\"{selected}\" tools=\"{tools}\">\n  <div slot=\"control\" class=\"flex-grow self-center ml-3\">\n    <div class=\"w-full p-2 flex bg-gray-100 rounded-lg\">\n      <label class=\"flex-none w-20 self-center text-xs uppercase text-gray-500 font-semibold\">Search</label>\n      <input bind:value=\"{query}\" class=\"flex-grow focus:outline-none bg-gray-100\" type=\"text\"\n        placeholder=\"Phone Number (e.g : 0123456789)\">\n      <button on:click=\"{searchNumber}\" class=\"w-10 h-10 rounded-full bg-gray-400\">\n        <i class=\"icon ion-md-search text-2xl text-gray-600\"></i>\n      </button>\n    </div>\n  </div>\n</Toolbar>\n{#if !$customers}\n<p class=\"text-center text-2xl text-gray-600 mb-5\">\n  <i class=\"fas fa-search block\"></i>\nEnter a phone number to search for customers.\n</p>\n{:else if $customers.length>0}\n{#each $customers as customer (customer._id)}\n<UIItem>\n  <div class=\"flex-1 px-4 py-2 m-2\" on:click=\"{ () => inspect(customer)}\">\n    {customer.firstName} {customer.lastName}\n  </div>\n  <span class=\"inline-block bg-orange-200 rounded p-2 text-sm font-semibold text-gray-700 mr-2 flex-none h-auto self-center\">\n    {customer.Points} points\n  </span>\n  <span class=\"inline-block bg-gray-200 rounded p-2 text-sm font-semibold text-gray-700 mr-2 flex-none h-auto self-center\">\n    {customer.Phone}\n  </span>\n</UIItem>\n{/each}\n{:else if $customers.length==0}\n<p class=\"text-center text-2xl text-gray-600 my-auto\">\n  <i class=\"far fa-times-circle block\"></i>\nNo Customer Found. Please try again.\n</p>\n{/if}"],"names":["ctx","length","date","replace","Source","Amount","AmountBefore","Gender","firstName","lastName","Email","Phone","Notes","list","loading","dob","customer","DOB","Date","toJSON","slice","onMount","fetch","api","_id","headers","then","r","json","console","log","container","name","icon","function","e","detail","pop_modal","$customers","map","dispatch","createEventDispatcher","source","file_content","reader","FileReader","onload","result","readAsBinaryString","files","Papa","parse","header","send","chunk","shift","arr","len","chunks","i","n","push","data","body","toolbar","Points","query","undefined","inspect","c","$modal","view","CustomerView","$loading","CustomerImport","custs","clean","download","unparse"],"mappings":"+zBA+BWA,4GAAAA,2VA2EAA,0BAALC,6eAAKD,aAALC,qIAAAA,+cAIOD,MAAOE,KAAOF,MAAOE,KAAKC,QAAQ,KAAK,QAAU,SAKvDH,MAAOI,aAITJ,MAAOK,OAAOL,MAAOM,aAAeN,MAAOK,OAAOL,MAAOM,aAAe,UAGxEN,MAAOM,aAAaN,MAAOK,OAASL,MAAOM,aAAaN,MAAOK,OAAS,4dAZhEL,MAAOE,KAAOF,MAAOE,KAAKC,QAAQ,KAAK,QAAU,qCAKvDH,MAAOI,gCAITJ,MAAOK,OAAOL,MAAOM,aAAeN,MAAOK,OAAOL,MAAOM,aAAe,6BAGxEN,MAAOM,aAAaN,MAAOK,OAASL,MAAOM,aAAaN,MAAOK,OAAS,2LAhCvEL,KAKmB,GAAbA,KAAKC,09DAtBsE,KAAjBD,KAASO,OAAc,MAAQ,wCAAsD,KAAjBP,KAASO,OAAc,MAAQ,oEAGlF,KAAjBP,KAASO,OAAc,MAAQ,wCAAsD,KAAjBP,KAASO,OAAc,MAAQ,6jBA7B9DP,KAASQ,kDAIVR,KAASS,wDAMZT,KAASU,8CAITV,KAASW,4DAOfX,4HAiBjDA,KAASY,iPAtCkDZ,KAASQ,eAATR,KAASQ,0BAIVR,KAASS,cAATT,KAASS,yBAMZT,KAASU,WAATV,KAASU,gBAITV,KAASW,sBAOfX,UAAAA,8BAKV,KAAjBA,KAASO,OAAc,MAAQ,wCAAsD,KAAjBP,KAASO,OAAc,MAAQ,mFAGlF,KAAjBP,KAASO,OAAc,MAAQ,wCAAsD,KAAjBP,KAASO,OAAc,MAAQ,oEASzHP,KAASY,kKA8CXZ,WAAgBA,gCAAnCA,urBA7HMa,EAA3BC,GAAU,EAAOC,EAAM,aAChBC,QACXD,EAAMC,EAASC,QAAUC,KAAKF,EAASC,KAAKE,SAASC,MAAM,EAAE,IAAM,GACnEC,OACIC,MAAMC,2BAA6BP,EAASQ,OAAOC,KAAWC,KAAKC,GAAKA,EAAEC,QAAQF,KAAKC,QACrFd,EAAOc,GACPE,QAAQC,IAAIjB,sEAGCkB,UAAY,iBAChBC,KAAO,QAASC,KAAO,eAAgBC,SAAW,cAClDF,KAAO,OAAQC,KAAO,mBAAoBC,SAAW,kBAClDC,GACM,aAAnBA,EAAEC,OAAOF,UACVG,IAEoB,QAAnBF,EAAEC,OAAOF,eACVpB,GAAU,OACVE,EAASC,IAAMF,KACfO,MAAMC,mBAAqBE,EAAQT,IAAWU,KAAKC,QAAOb,GAAU,OAAOwB,EAAaA,EAAWC,IAAIZ,GAAKA,EAAEH,KAAKR,EAASQ,IAAMR,EAAWW,qBAsBxCX,EAASR,wCAIVQ,EAASP,uCAMZO,EAASN,oCAITM,EAASL,oCAOfI,6BAKrEC,EAAST,OAAS,eAGlBS,EAAST,OAAS,kBASES,EAASJ,0dC1B9CZ,6GAAAA,+2BAeY,IAAdA,2UAD+F,IAAdA,KAAmB,gBAAkB,qLAQpDA,wJAR6B,IAAdA,KAAmB,gBAAkB,mIAajFA,gCAAnBA,qXA7BRA,+fAtDZwC,EAAWC,QAIZC,EAAQ5B,GAAU,EAAO6B,EAAe,GAAIC,MAAaC,0BAC9Cb,KAAO,QAASC,KAAO,eAAgBC,SAAW,cAClDF,KAAO,OAAQC,KAAO,mBAAoBC,SAAW,oBAElEU,EAAOE,gBAAgBH,EAAeC,EAAOG,SAC7CH,EAAOI,mBAAmBN,EAAOO,MAAM,cAcvBd,MACM,aAAnBA,EAAEC,OAAOF,UACVG,IAEoB,QAAnBF,EAAEC,OAAOF,UAAkC,IAAdS,OAExBI,EAASG,KAAKC,MAAMR,GAAeS,QAAS,QAChDtC,GAAU,YAOPuC,EAAKC,OACRzC,EAAOyC,EAAMC,QACjBjC,MAAMC,EAAI,mBAAmBE,EAAQZ,IAAOa,KAAKC,GAAKA,EAAEC,QAAQF,KAAKC,IAE7DE,QAAQC,IAAI,UAAUwB,EAAMrD,QACX,GAAdqD,EAAMrD,OACPoC,IAEAgB,EAAKC,KAXbD,UAvBYG,EAAKC,WAEjBC,KACAC,EAAI,EACJC,EAAIJ,EAAIvD,OAEL0D,EAAIC,GACTF,EAAOG,KAAKL,EAAIpC,MAAMuC,EAAGA,GAAKF,WAGzBC,EAYUJ,CAFGP,EAAOe,KAEM,SAgBnBC,KAAO,mBAAoBC,QAAU,iEA6BCtB,4wBC3C5B1C,6DAEDA,8BAFCA,UAAAA,mTAcnBA,gBAAwBA,MAASwB,oBAAtCvB,uMAAKD,qFAALC,8ZAGGD,MAASQ,eAAYR,MAASS,cAG9BT,MAASiE,YAGTjE,MAASW,ulBANTX,MAASQ,kCAAYR,MAASS,iCAG9BT,MAASiE,+BAGTjE,MAASW,+fA3B6DX,gEAAnBA,qDAYlDA,KAKIA,KAAWC,OAAO,IAcC,GAAnBD,KAAWC,iwBA1DfiE,EAAQ,OAAI5B,OAAa6B,YAOpBC,EAAQC,OACfC,MAAaA,GAAUtD,SAAUqD,EAAGE,KAAMC,mBAP7BxC,KAAM,SAAUC,KAAM,iBAAkBC,SAAU,WAC/DF,KAAM,SAAUC,KAAM,eAAgBC,SAAU,0BAEhDuC,GAAW,OAAMnC,OAAa6B,GAC9B7C,MAAMC,mBAAqB2C,KAAUzC,KAAWC,KAAKC,QAAO8C,GAAW,GAAc9C,EAAEC,SAAUF,KAAKC,OAAKW,EAAaX,gBAKxGQ,UACRA,EAAEC,OAAOF,cACV,aACHoC,MAAaA,GAAUC,KAAMG,gBAE1B,cAEGC,EAAQrC,EAAWC,IAAIZ,GAAKiD,EAAMjD,GAAI,QAAS,MAAO,YAAa,WAAY,SAAU,WAC7FkD,EAAS3B,KAAK4B,QAAQH,GAAQ,gBAAiB,6CAa/BT,wBAgB4BE,EAAQpD"}