{"version":3,"file":"OrderSummary-835a13c8.js","sources":["../../src/OrderSummary.html"],"sourcesContent":["<svelte:head>\n    <script src=\"https://unpkg.com/papaparse@latest/papaparse.min.js\"></script>\n</svelte:head>\n<script>\n    import dayjs from \"dayjs\"\n    import Toolbar from './UI/UIToolbar.html';\n    import { api, fetch, session, modal, settings, loading, download, apply } from './CTStore.js';\n    import UIItem from './UI/UIItem.html'\n    let selected_date = dayjs();\n    let orders = {}, page = 0, show_more = true, raw_orders = {}, products = [], vendors = [];\n    let tools = [{ name: \"Refresh\", icon: \"refresh\", function: \"refresh\" },\n    { name: \"Export\", icon: \"cloud-download\", function: \"export\" }]\n    get_orders(0);\n    fetch(api('/vendor')).then(r => { vendors = r });\n\n    function selected(e) {\n        switch (e.detail.function) {\n            case \"refresh\":\n                get_orders(0)\n                break;\n            case \"export\":\n                {\n                    let orders = [];\n                    raw_orders.forEach(r => {\n                        if (r.payment) {\n                            let fields = {\n                                \"order_date\": dayjs(r.createdAt).format('MM/DD h:mmA'),\n                                \"name\": r.guest.name,\n                                \"phone\": r.guest.phone,\n                                \"address\": `${r.guest.address || ''} ${r.guest.address2 || ''}`,\n                                \"isPickUp\": r.guest.address ? 'N' : 'Y',\n                                \"amount\": r.payment.amount.toFixed(2),\n                                \"paid\": r.payment.paidAt ? dayjs(r.payment.paidAt).format('MM/DD h:mmA') : '',\n                                \"invoice\": `https://pay.getorders.app/?i=${r.invoice_id}`\n                            }\n                            orders = [...orders, fields];\n                        }\n                    })\n                    download(Papa.unparse(orders), 'orders.csv', 'text/csv;encoding:utf-8');\n                }\n                break;\n        }\n    }\n    apply.subscribe(cb => {\n        if (cb.order) {\n            raw_orders = raw_orders.map(o => {\n                if (o.invoice_id == cb.order.invoice_id) {\n                    o = cb.order;\n                }\n                return o;\n            });\n            process_orders();\n        }\n    });\n    function get_orders(pg) {\n        if (pg == 0) {\n            show_more = true;\n        }\n        page = pg;\n        $loading = true;\n        fetch(api(`/orders`), { groupBy: \"products\", from: selected_date.startOf('day').toJSON(), to: selected_date.endOf('day').toJSON() }, 'GET').then(data => {\n            $loading = false;\n            raw_orders = data.variants;\n            products = data.products;\n            console.log(raw_orders);\n            console.log(products);\n            process_products();\n        });\n    }\n    function prodFor(prod_id) {\n        return products.find(p => p.id.toString() == prod_id) || { name: \"-\" };\n    }\n    function process_products() {\n\n    }\n    function calc(sum, item) {\n        return parseFloat(sum) + parseFloat(item.unit_price) * item.quantity;\n    }\n    function message(order) {\n        let phone = order.guest.phone;\n        if (phone.startsWith('01')) phone = \"6\" + phone;\n        let url = `https://api.whatsapp.com/send?phone=${phone}&text=`, msg = \"\";\n        if (order.payment) {\n            msg = `Hey there! We *(${$settings.settings.name})* have received your order, tap here to pay now.`;\n            msg = `${msg} üëâüèª https://pay.getorders.app/?i=${order.invoice_id}\\n\\n`;\n        }\n        let txt = encodeURIComponent(msg)\n        document.location.href = `${url}${txt}`;\n    }\n    let status_colors = ['bg-gray-400', 'bg-gray-400', 'bg-gray-400', 'bg-yellow-500', 'bg-red-400', 'bg-green-500', 'bg-pink-500', 'bg-theme']\n    function changeDate(day) {\n        selected_date = selected_date.add(day, 'day');\n        get_orders(0);\n    }\n</script>\n<style>\n    .action {\n        @apply rounded-full text-white mr-3 w-16 h-16 text-center self-center text-2xl flex-none shadow-md;\n    }\n\n    td {\n        @apply p-2;\n    }\n</style>\n<Toolbar class=\"border-b border-gray-300\" on:selected=\"{selected}\" tools=\"{tools}\" />\n<div class=\"flex text-lg font-semibold m-2\">\n    <button on:click=\"{ () => changeDate(-1) }\"><i class=\"far fa-arrow-alt-circle-left\"></i></button>\n    <div class=\"flex-grow self-center text-center\">\n        {selected_date.format('ddd D/M/YY')}\n    </div>\n    <button on:click=\"{ () => changeDate(1) }\"><i class=\"far fa-arrow-alt-circle-right\"></i></button>\n</div>\n<div class=\"m-2\">\n    <table class=\"w-full\">\n        <tr class=\"bg-theme text-white rounded-lg\">\n            <td>Product</td>\n            <td>Variant</td>\n            <td>Modifiers</td>\n            <td>Quantity</td>\n            <td>Total Price</td>\n        </tr>\n        {#each Object.keys(raw_orders) as prod_id}\n        {#each Object.keys(raw_orders[prod_id]) as variant}\n        {#each Object.keys(raw_orders[prod_id][variant]) as mods}\n    <tr>\n        <td>{prodFor(prod_id).name}</td>\n        <td>{variant}</td>\n        <td>{mods}</td>\n        <td>{raw_orders[prod_id][variant][mods].quantity}</td>\n        <td>{raw_orders[prod_id][variant][mods].quantity}</td>\n    </tr>\n        {/each}\n        {/each}\n        {/each}\n    </table>\n</div>"],"names":["ctx","name","quantity","Object","keys","length","format","selected_date","dayjs","page","show_more","raw_orders","products","vendors","get_orders","pg","$loading","fetch","api","groupBy","from","startOf","toJSON","to","endOf","then","data","variants","console","log","r","apply","subscribe","cb","order","map","o","invoice_id","process_orders","changeDate","day","add","icon","function","e","detail","orders","forEach","payment","fields","order_date","createdAt","guest","phone","address","address2","isPickUp","amount","toFixed","paid","paidAt","invoice","download","Papa","unparse","prod_id","find","p","id","toString","startsWith","url","msg","$settings","settings","txt","encodeURIComponent","document","location","href"],"mappings":"4kBAsIaA,KAAQA,OAASC,UACjBD,WACAA,WACAA,KAAWA,OAASA,OAASA,OAAME,cACnCF,KAAWA,OAASA,OAASA,OAAME,mbAJnCF,KAAQA,OAASC,6BACjBD,8BACAA,8BACAA,KAAWA,OAASA,OAASA,OAAME,iCACnCF,KAAWA,OAASA,OAASA,OAAME,2DANjCC,OAAOC,KAAKJ,KAAWA,OAASA,6BAArCK,yKAAKF,OAAOC,KAAKJ,KAAWA,OAASA,gBAArCK,qIAAAA,qDADKF,OAAOC,KAAKJ,KAAWA,6BAA5BK,yKAAKF,OAAOC,KAAKJ,KAAWA,gBAA5BK,qIAAAA,uFAdDL,KAAcM,OAAO,8EAJ6CN,yBAAnBA,YAiBzCG,OAAOC,KAAKJ,2BAAjBK,wrCAbDL,KAAcM,OAAO,4CAafH,OAAOC,KAAKJ,cAAjBK,6HAAAA,uNA7HFE,EAAgBC,IACHC,EAAO,EAAGC,GAAY,EAAMC,KAAiBC,KAAeC,cA6CpEC,EAAWC,GACN,GAANA,IACAL,GAAY,GAEhBD,EAAOM,MACPC,GAAW,GACXC,EAAMC,cAAkBC,QAAS,WAAYC,KAAMb,EAAcc,QAAQ,OAAOC,SAAUC,GAAIhB,EAAciB,MAAM,OAAOF,UAAY,OAAOG,KAAKC,QAC7IV,GAAW,OACXL,EAAae,EAAKC,UAClBf,EAAWc,EAAKd,SAChBgB,QAAQC,IAAIlB,GACZiB,QAAQC,IAAIjB,KArDpBE,EAAW,GACXG,EAAMC,EAAI,YAAYO,KAAKK,IAAOjB,EAAUiB,IA8B5CC,EAAMC,UAAUC,IACRA,EAAGC,YACHvB,EAAaA,EAAWwB,IAAIC,IACpBA,EAAEC,YAAcJ,EAAGC,MAAMG,aACzBD,EAAIH,EAAGC,OAEJE,KAEXE,6BAuCCC,EAAWC,OAChBjC,EAAgBA,EAAckC,IAAID,EAAK,QACvC1B,EAAW,gBAlFAb,KAAM,UAAWyC,KAAM,UAAWC,SAAU,YACzD1C,KAAM,SAAUyC,KAAM,iBAAkBC,SAAU,oBAIlCC,UACNA,EAAEC,OAAOF,cACR,UACD7B,EAAW,aAEV,cAEOgC,KACJnC,EAAWoC,QAAQjB,OACXA,EAAEkB,aACEC,GACAC,WAAc1C,EAAMsB,EAAEqB,WAAW7C,OAAO,eACxCL,KAAQ6B,EAAEsB,MAAMnD,KAChBoD,MAASvB,EAAEsB,MAAMC,MACjBC,WAAcxB,EAAEsB,MAAME,SAAW,MAAMxB,EAAEsB,MAAMG,UAAY,KAC3DC,SAAY1B,EAAEsB,MAAME,QAAU,IAAM,IACpCG,OAAU3B,EAAEkB,QAAQS,OAAOC,QAAQ,GACnCC,KAAQ7B,EAAEkB,QAAQY,OAASpD,EAAMsB,EAAEkB,QAAQY,QAAQtD,OAAO,eAAiB,GAC3EuD,wCAA2C/B,EAAEO,cAEjDS,MAAaA,EAAQG,MAG7Ba,EAASC,KAAKC,QAAQlB,GAAS,aAAc,uCA+B5CmB,UACNrD,EAASsD,KAAKC,GAAKA,EAAEC,GAAGC,YAAcJ,KAAchE,KAAM,kCAQpDiC,OACTmB,EAAQnB,EAAMkB,MAAMC,MACpBA,EAAMiB,WAAW,QAAOjB,EAAQ,IAAMA,OACtCkB,yCAA6ClB,UAAemB,EAAM,GAClEtC,EAAMc,UACNwB,qBAAyBC,EAAUC,SAASzE,wDAC5CuE,KAASA,uCAAyCtC,EAAMG,sBAExDsC,EAAMC,mBAAmBJ,GAC7BK,SAASC,SAASC,QAAUR,IAAMI,MAEjB,cAAe,cAAe,cAAe,gBAAiB,aAAc,eAAgB,cAAe,gBA6BtGpC,GAAY,OAIZA,EAAW"}