{"version":3,"file":"Outlets-3479c76e.js","sources":["../../src/OutletView.html","../../src/Outlets.html"],"sourcesContent":["<script>\n  import { onMount } from 'svelte';\n  import Toolbar from './UI/UIToolbar.html'\n  import TextField from './UI/UITextField.html';\n  import UIItem from './UI/UIItem.html';\n  import ModalView from './UI/UIModalView.html'\n  import Loading from './UI/UILoading.html'\n  import { session, api, alert, accounts, modal, selected_obj, customers, pop_modal, fetch } from './CTStore.js';\n  export let outlet = {}, acc_id = \"\";\n  let tool_style = { container: \"justify-end\" }\n  let tools = [{ name: \"Close\", icon: \"close-circle\", function: \"pop_modal\" },\n  { name: \"Save\", icon: \"checkmark-circle\", function: \"save\" }]\n  let loading = true, list = [];\n  if (!outlet.phone) {\n    outlet.phone = \"\"\n  }\n  refresh()\n  let field_style = { container: \"p-2 w-1/2 flex-none mb-2\" }\n  function refresh() {\n    fetch(api(`/devices/${acc_id}/${outlet.id}`)).then(r => {\n      list = r;\n      loading = false;\n    });\n  }\n\n  function add() {\n    loading = true;\n    fetch(api(`/devices/${acc_id}/${outlet.id}`), {}).then(r => { refresh(); });\n  }\n\n  function selected(e) {\n    if (e.detail.function == 'pop_modal') {\n      pop_modal()\n    }\n    if (e.detail.function == 'save') {\n      loading = true;\n      fetch(api(`/outlet`), { _id: outlet._id, phone: outlet.phone, address: outlet.address, \"address2\": outlet.address2, \"postcode\": outlet.postcode }).then(r => { loading = false; $accounts = r; });\n    }\n  }\n  let style = { content: 'overflow-y-scroll scrolling-touch' }\n</script>\n<ModalView style=\"{style}\">\n  <div slot=\"loader\">\n    {#if loading}\n  <Loading>\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n    {/if}\n  </div>\n  <div slot=\"title\" class=\"text-center font-semibold text-2xl text-gray-600 m-2 flex\">\n    {outlet.name}\n  </div>\n  <div slot=\"content\" class=\"p-2 overflow-y-auto\">\n      <p class=\"text-lg m-2 font-semibold text-gray-600\"><i class=\"icon ion-md-alert\"></i> Outlet Info</p>\n      <TextField style=\"{field_style}\" label=\"Phone Number\" bind:value=\"{outlet.phone}\" />\n      <TextField style=\"{field_style}\" label=\"Address\" bind:value=\"{outlet.address}\" />\n      <TextField style=\"{field_style}\" label=\"Address 2\" bind:value=\"{outlet.address2}\" />\n      <TextField style=\"{field_style}\" label=\"Postcode\" bind:value=\"{outlet.postcode}\" />\n      <TextField style=\"{field_style}\" label=\"Coordinates\" placeholder=\"3.123123,4.123231\" bind:value=\"{outlet.coordinates}\" />\n      <p class=\"text-xs px-3 mb-3 font-semibold\">\n        Ensure that the details above is correct, as price estimation and riders depend on the accuracy of this information.\n      </p>\n      <p class=\"text-lg m-2 font-semibold text-gray-600\"><i class=\"icon ion-md-tablet-portrait\"></i> Devices</p>\n\n{#each list as device}\n<UIItem>\n  <div class=\"flex-1 px-4 py-2 m-2\">\n    {device.code}\n  </div>\n</UIItem>\n{/each}\n      <div class=\"rounded-lg cursor-pointer border border-dashed border-gray-300 m-2 p-2 text-gray-500 bounce h-12 flex\" on:click=\"{add}\">\n        <div class=\"flex-grow self-center\"><i class=\"icon ion-md-add\"></i> Add New Device</div>\n      </div>\n\n  </div>\n  <div slot=\"toolbar\">\n    <Toolbar on:selected=\"{selected}\" tools=\"{tools}\" style=\"{tool_style}\" />\n  </div>\n</ModalView>","<script>\n  import Toolbar from './UI/UIToolbar.html';\n  import UIItem from './UI/UIItem.html';\n  import LoadingView from './UI/UILoading.html';\n  import OutletView from './OutletView.html';\n  import { onMount } from 'svelte';\n  import { session, api, fetch, trigger, modal, uuid, loading } from './CTStore.js';\n  let current_sync, sync = false, accounts;\n  let tools = [{ name: \"Refresh\", icon: \"refresh\", function: \"refresh\" }]\n  function selected(e) {\n    switch (e.detail.function) {\n      case \"refresh\":\n        {\n          if (sync == false) refresh(0, 0)\n        }\n        break;\n    }\n  }\n  function refresh(acc, outlet) {\n    sync = true;\n    let outlet_id = accounts[acc].outlets[outlet].id;\n    current_sync = outlet_id;\n    fetch(api('/accounts/refresh'),{ outlet_id }).then(o => {\n      if (outlet + 1 == accounts[acc].outlets.length) {\n        if (acc + 1 < accounts.length) {\n          refresh(acc + 1, 0);\n        } else {\n          current_sync = \"\"; sync = false;\n        }\n      } else {\n        refresh(acc, outlet + 1);\n      }\n    });\n  }\n  function toggle(outlet_id, app_hidden) {\n    $loading = true;\n    fetch(api(`/outlet`), { _id: outlet_id, app_hidden: (app_hidden == 'true') })\n      .then(r => { $loading = false; accounts = r; });\n  }\n  fetch(api('/accounts')).then(o => { accounts = o })\n</script>\n<style>\n  .toggle {\n    @apply w-10 text-center self-center;\n  }\n</style>\n<Toolbar class=\"border-b border-gray-300\" on:selected=\"{selected}\" tools=\"{tools}\" />\n{#if !accounts}\n  <LoadingView type=\"h-64\">\n    <div slot=\"message\">\n      Retrieving Outlets..\n    </div>\n  </LoadingView>\n{:else}\n{#if accounts[0].outlets.length==0}\n<LoadingView type=\"h-64\" spinner=\"false\">\n  <div slot=\"message\">\n    No outlets configured.\n  </div>\n</LoadingView>\n{:else}\n{#each accounts as acc}\n{#each acc.outlets as outlet, i}\n<UIItem>\n    <i class=\"toggle fas { outlet.app_hidden ? 'fa-eye-slash' : 'fa-eye' }\"\n      on:click=\"{ () => toggle(outlet._id, outlet.app_hidden ? 'false' : 'true') }\"></i>\n  <div class=\"flex-1 p-2 m-2\" on:click=\"{ () => { $modal = [...$modal, { outlet, index : i, acc_id : acc._id, view : OutletView }];} }\">\n    {outlet.name}\n  </div>\n  {#if current_sync==outlet.id}\n  <span class=\"inline-block px-4 py-2 m-2 flex-none\">\n    <i class=\"fas fa-sync fa-spin\"></i>\n  </span>\n  {/if}\n</UIItem>\n{/each}\n{/each}\n{/if}\n{/if}"],"names":["ctx","name","code","phone","address","address2","postcode","coordinates","length","outlet","acc_id","loading","list","refresh","fetch","api","id","then","r","container","icon","function","e","detail","pop_modal","_id","$accounts","content","app_hidden","outlets","current_sync","accounts","sync","acc","outlet_id","o","toggle","$loading","$modal","index","i","view","OutletView"],"mappings":"w0BA2CSA,4GAAAA,yKASJA,KAAOC,8KAAPD,KAAOC,yDAiBPD,MAAOE,qHAAPF,MAAOE,oaAbaF,oCAAgDA,KAAOG,gBAAPH,KAAOG,yGACvDH,+BAA2CA,KAAOI,kBAAPJ,KAAOI,2GAClDJ,iCAA6CA,KAAOK,mBAAPL,KAAOK,4GACpDL,gCAA4CA,KAAOM,mBAAPN,KAAOM,gHACnDN,mEAA+EA,KAAOO,uBAAPP,KAAOO,4EAMxGP,4BAALQ,guCAOkIR,gDAjB3DA,KAAOG,+DACZH,KAAOI,iEACLJ,KAAOK,kEACRL,KAAOM,sEAC4BN,KAAOO,sDAMxGP,cAALQ,2HAAAA,kKAAAA,4SAa4CR,WAAgBA,gCAAnCA,6WAtCRA,0VAjCNS,gBAAaC,EAAS,MAI7BC,GAAU,EAAMC,KACfH,EAAON,QACVM,EAAON,MAAQ,IAEjBU,aAESA,IACPC,EAAMC,cAAgBL,KAAUD,EAAOO,OAAOC,KAAKC,QACjDN,EAAOM,OACPP,GAAU,4FAZKQ,UAAW,iBACflB,KAAM,QAASmB,KAAM,eAAgBC,SAAU,cAC5DpB,KAAM,OAAQmB,KAAM,mBAAoBC,SAAU,UAMhCF,UAAW,2CAS7BR,GAAU,GACVG,EAAMC,cAAgBL,KAAUD,EAAOO,UAAWC,KAAKC,IAAOL,gBAG9CS,GACS,aAArBA,EAAEC,OAAOF,UACXG,IAEuB,QAArBF,EAAEC,OAAOF,eACXV,GAAU,GACVG,EAAMC,cAAkBU,IAAKhB,EAAOgB,IAAKtB,MAAOM,EAAON,MAAOC,QAASK,EAAOL,QAASC,SAAYI,EAAOJ,SAAUC,SAAYG,EAAOH,WAAYW,KAAKC,QAAOP,GAAU,OAAOe,EAAYR,QAGlLS,QAAS,uDAiBgDlB,EAAON,4BACZM,EAAOL,8BACLK,EAAOJ,+BACRI,EAAOH,+BAC4BG,EAAOF,sPCGxGP,0BAALQ,sNAAKR,aAALQ,8HAAAA,8DAAAA,w6BAMGR,MAAOC,6GAELD,MAAcA,MAAOgB,uGALDhB,MAAO4B,WAAa,eAAiB,qNAArC5B,MAAO4B,WAAa,eAAiB,wDAG3D5B,MAAOC,iBAELD,MAAcA,MAAOgB,8aAPrBhB,MAAI6B,6BAATrB,sNAAKR,MAAI6B,gBAATrB,8HAAAA,8DAAAA,8dAhByER,yBAAnBA,qDAClDA,KAO2B,GAA5BA,KAAS,GAAG6B,QAAQrB,4cAjDnBsB,EAA4BC,EAAdC,GAAO,WAWhBnB,EAAQoB,EAAKxB,GACpBuB,GAAO,MACHE,EAAYH,EAASE,GAAKJ,QAAQpB,GAAQO,OAC9Cc,EAAeI,GACfpB,EAAMC,EAAI,sBAAuBmB,UAAAA,IAAajB,KAAKkB,IAC7C1B,EAAS,GAAKsB,EAASE,GAAKJ,QAAQrB,OAClCyB,EAAM,EAAIF,EAASvB,OACrBK,EAAQoB,EAAM,EAAG,QAEjBH,EAAe,IAAIE,GAAO,GAG5BnB,EAAQoB,EAAKxB,EAAS,cAInB2B,EAAOF,EAAWN,OACzBS,GAAW,GACXvB,EAAMC,cAAkBU,IAAKS,EAAWN,WAA2B,QAAdA,IAClDX,KAAKC,QAAOmB,GAAW,OAAON,EAAWb,KAE9CJ,EAAMC,EAAI,cAAcE,KAAKkB,QAAOJ,EAAWI,oBA/BhClC,KAAM,UAAWmB,KAAM,UAAWC,SAAU,qBACzCC,UACRA,EAAEC,OAAOF,cACV,UAEW,GAARW,GAAenB,EAAQ,EAAG,gBAsDhBuB,EAAO3B,EAAOgB,IAAKhB,EAAOmB,WAAa,QAAU,sBACvBU,MAAaA,GAAU7B,OAAAA,EAAQ8B,MAAQC,EAAG9B,OAASuB,EAAIR,IAAKgB,KAAOC"}