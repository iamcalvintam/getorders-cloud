{"version":3,"file":"Outlets-28d2ee28.js","sources":["../../src/OutletView.html","../../src/Outlets.html"],"sourcesContent":["<script>\n  import { onMount } from 'svelte';\n  import Toolbar from './UI/UIToolbar.html'\n  import TextField from './UI/UITextField.html';\n  import UIItem from './UI/UIItem.html';\n  import ModalView from './UI/UIModalView.html'\n  import Loading from './UI/UILoading.html'\n  import { session, api, alert, accounts, modal, selected_obj, headers, customers, pop_modal } from './CTStore.js';\n  export let outlet = {}, acc_id = \"\";\n  let tool_style = { container: \"justify-end\" }\n  let tools = [{ name: \"Close\", icon: \"close-circle\", function: \"pop_modal\" },\n  { name: \"Save\", icon: \"checkmark-circle\", function: \"save\" }]\n  let loading = true, list = [];\n  if (!outlet.phone) {\n    outlet.phone = \"\"\n  }\n  refresh()\n  let field_style = { container: \"p-2 w-1/2 flex-none mb-2\" }\n  function refresh() {\n    fetch(api(`/devices/${acc_id}/${outlet.id}`), headers()).then(r => r.json()).then(r => {\n      list = r;\n      loading = false;\n    });\n  }\n\n  function add() {\n    loading = true;\n    fetch(api(`/devices/${acc_id}/${outlet.id}`), headers({}, \"POST\")).then(r => { refresh(); });\n  }\n\n  function selected(e) {\n    if (e.detail.function == 'pop_modal') {\n      pop_modal()\n    }\n    if (e.detail.function == 'save') {\n      loading = true;\n      fetch(api(`/outlet`), headers({ _id: outlet._id, phone: outlet.phone })).then(r => { loading = false; $accounts = r; });\n    }\n  }\n  let style = { content: 'overflow-y-scroll scrolling-touch' }\n</script>\n<ModalView style=\"{style}\">\n  <div slot=\"loader\">\n    {#if loading}\n  <Loading>\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n    {/if}\n  </div>\n  <div slot=\"title\" class=\"text-center font-semibold text-2xl text-gray-600 m-2 flex\">\n    {outlet.name}\n  </div>\n  <div slot=\"content\" class=\"p-2 overflow-y-auto\">\n      <p class=\"text-lg m-2 font-semibold text-gray-600\"><i class=\"icon ion-md-alert\"></i> Outlet Info</p>\n      <TextField style=\"{field_style}\" label=\"Phone Number\" bind:value=\"{outlet.phone}\" />\n\n      <p class=\"text-lg m-2 font-semibold text-gray-600\"><i class=\"icon ion-md-tablet-portrait\"></i> Devices</p>\n\n{#each list as device}\n<UIItem>\n  <div class=\"flex-1 px-4 py-2 m-2\">\n    {device.code}\n  </div>\n</UIItem>\n{/each}\n      <div class=\"rounded-lg cursor-pointer border border-dashed border-gray-300 m-2 p-2 text-gray-500 bounce h-12 flex\" on:click=\"{add}\">\n        <div class=\"flex-grow self-center\"><i class=\"icon ion-md-add\"></i> Add New Device</div>\n      </div>\n\n  </div>\n  <div slot=\"toolbar\">\n    <Toolbar on:selected=\"{selected}\" tools=\"{tools}\" style=\"{tool_style}\" />\n  </div>\n</ModalView>","<script>\n  import Toolbar from './UI/UIToolbar.html';\n  import UIItem from './UI/UIItem.html';\n  import LoadingView from './UI/UILoading.html';\n  import OutletView from './OutletView.html';\n  import { onMount } from 'svelte';\n  import { session, api, headers, trigger, modal, uuid, loading } from './CTStore.js';\n  let current_sync, sync = false, accounts;\n  let tools = [{ name: \"Refresh\", icon: \"refresh\", function: \"refresh\" }]\n  function selected(e) {\n    switch (e.detail.function) {\n      case \"refresh\":\n        {\n          if (sync == false) refresh(0, 0)\n        }\n        break;\n    }\n  }\n  function refresh(acc, outlet) {\n    sync = true;\n    let outlet_id = accounts[acc].outlets[outlet].id;\n    current_sync = outlet_id;\n    fetch(api('/accounts/refresh'), headers({ outlet_id })).then(r => r.json()).then(o => {\n      if (outlet + 1 == accounts[acc].outlets.length) {\n        if (acc + 1 < accounts.length) {\n          refresh(acc + 1, 0);\n        } else {\n          current_sync = \"\"; sync = false;\n        }\n      } else {\n        refresh(acc, outlet + 1);\n      }\n    });\n  }\n  function toggle(outlet_id, app_hidden) {\n    $loading = true;\n    fetch(api(`/outlet`), headers({ _id: outlet_id, app_hidden: (app_hidden == 'true') }))\n      .then(r => r.json())\n      .then(r => { $loading = false; accounts = r; });\n  }\n  fetch(api('/accounts'), headers()).then(r => r.json()).then(o => { accounts = o })\n</script>\n<style>\n  .toggle {\n    @apply w-10 text-center self-center;\n  }\n</style>\n<Toolbar class=\"border-b border-gray-300\" on:selected=\"{selected}\" tools=\"{tools}\" />\n{#if !accounts}\n  <LoadingView>\n    <div slot=\"message\">\n      Retrieving Outlets..\n    </div>\n  </LoadingView>\n{:else}\n{#if accounts[0].outlets.length==0}\n<LoadingView spinner=\"false\">\n  <div slot=\"message\">\n    No outlets configured.\n  </div>\n</LoadingView>\n{:else}\n{#each accounts as acc}\n{#each acc.outlets as outlet, i}\n<UIItem>\n    <i class=\"toggle fas { outlet.app_hidden ? 'fa-eye-slash' : 'fa-eye' }\"\n      on:click=\"{ () => toggle(outlet._id, outlet.app_hidden ? 'false' : 'true') }\"></i>\n  <div class=\"flex-1 p-2 m-2\" on:click=\"{ () => { $modal = [...$modal, { outlet, index : i, acc_id : acc._id, view : OutletView }];} }\">\n    {outlet.name}\n  </div>\n  {#if current_sync==outlet.id}\n  <span class=\"inline-block px-4 py-2 m-2 flex-none\">\n    <i class=\"fas fa-sync fa-spin\"></i>\n  </span>\n  {/if}\n</UIItem>\n{/each}\n{/each}\n{/if}\n{/if}"],"names":["ctx","name","code","phone","length","outlet","acc_id","loading","list","refresh","fetch","api","id","headers","then","r","json","container","icon","function","e","detail","pop_modal","_id","$accounts","content","app_hidden","outlets","current_sync","accounts","sync","acc","outlet_id","o","toggle","$loading","$modal","index","i","view","OutletView"],"mappings":"02BA2CSA,4GAAAA,yKASJA,KAAOC,8KAAPD,KAAOC,yDAWPD,MAAOE,qHAAPF,MAAOE,8YAPaF,oCAAgDA,KAAOG,gBAAPH,KAAOG,iEAIzEH,0BAALI,01BAOkIJ,mDAX3DA,KAAOG,8CAIzEH,aAALI,kHAAAA,iFAAAA,kMAa4CJ,WAAgBA,gCAAnCA,6WAhCRA,wVAjCNK,gBAAaC,EAAS,MAI7BC,GAAU,EAAMC,KACfH,EAAOF,QACVE,EAAOF,MAAQ,IAEjBM,aAESA,IACPC,MAAMC,cAAgBL,KAAUD,EAAOO,MAAOC,KAAWC,KAAKC,GAAKA,EAAEC,QAAQF,KAAKC,QAChFP,EAAOO,OACPR,GAAU,4FAZKU,UAAW,iBACfhB,KAAM,QAASiB,KAAM,eAAgBC,SAAU,cAC5DlB,KAAM,OAAQiB,KAAM,mBAAoBC,SAAU,UAMhCF,UAAW,2CAS7BV,GAAU,GACVG,MAAMC,cAAgBL,KAAUD,EAAOO,MAAOC,KAAY,SAASC,KAAKC,IAAON,gBAG/DW,GACS,aAArBA,EAAEC,OAAOF,UACXG,IAEuB,QAArBF,EAAEC,OAAOF,eACXZ,GAAU,GACVG,MAAMC,aAAgBE,GAAUU,IAAKlB,EAAOkB,IAAKpB,MAAOE,EAAOF,SAAUW,KAAKC,QAAOR,GAAU,OAAOiB,EAAYT,QAGxGU,QAAS,uDAiBgDpB,EAAOF,gPCQzEH,0BAALI,sNAAKJ,aAALI,8HAAAA,8DAAAA,g5BAMGJ,MAAOC,6GAELD,MAAcA,MAAOY,uGALDZ,MAAO0B,WAAa,eAAiB,qNAArC1B,MAAO0B,WAAa,eAAiB,wDAG3D1B,MAAOC,iBAELD,MAAcA,MAAOY,8aAPrBZ,MAAI2B,6BAATvB,sNAAKJ,MAAI2B,gBAATvB,8HAAAA,8DAAAA,8dAhByEJ,yBAAnBA,qDAClDA,KAO2B,GAA5BA,KAAS,GAAG2B,QAAQvB,4cAlDnBwB,EAA4BC,EAAdC,GAAO,WAWhBrB,EAAQsB,EAAK1B,GACpByB,GAAO,MACHE,EAAYH,EAASE,GAAKJ,QAAQtB,GAAQO,OAC9CgB,EAAeI,GACftB,MAAMC,EAAI,qBAAsBE,GAAUmB,UAAAA,KAAclB,KAAKC,GAAKA,EAAEC,QAAQF,KAAKmB,IAC3E5B,EAAS,GAAKwB,EAASE,GAAKJ,QAAQvB,OAClC2B,EAAM,EAAIF,EAASzB,OACrBK,EAAQsB,EAAM,EAAG,QAEjBH,EAAe,IAAIE,GAAO,GAG5BrB,EAAQsB,EAAK1B,EAAS,cAInB6B,EAAOF,EAAWN,OACzBS,GAAW,GACXzB,MAAMC,aAAgBE,GAAUU,IAAKS,EAAWN,WAA2B,QAAdA,KAC1DZ,KAAKC,GAAKA,EAAEC,QACZF,KAAKC,QAAOoB,GAAW,OAAON,EAAWd,KAE9CL,MAAMC,EAAI,aAAcE,KAAWC,KAAKC,GAAKA,EAAEC,QAAQF,KAAKmB,QAAOJ,EAAWI,oBAhC/DhC,KAAM,UAAWiB,KAAM,UAAWC,SAAU,qBACzCC,UACRA,EAAEC,OAAOF,cACV,UAEW,GAARW,GAAerB,EAAQ,EAAG,gBAuDhByB,EAAO7B,EAAOkB,IAAKlB,EAAOqB,WAAa,QAAU,sBACvBU,MAAaA,GAAU/B,OAAAA,EAAQgC,MAAQC,EAAGhC,OAASyB,EAAIR,IAAKgB,KAAOC"}