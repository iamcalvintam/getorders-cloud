{"version":3,"file":"Guestbook-c1ecb9b1.js","sources":["../../src/Guestbook.html"],"sourcesContent":["<svelte:head>\n    <script src=\"https://unpkg.com/papaparse@latest/papaparse.min.js\"></script>\n</svelte:head>\n<script>\n    import { onMount } from 'svelte';\n  import { writable, derived, get } from 'svelte/store';\n  import dayjs from \"dayjs\"\n  import Toolbar from './UI/UIToolbar.html';\n  import ActivatePay from './ActivatePay.html';\n  import OrdersExport from './OrdersExport.html';\n  import { api, fetch, session, modal, settings, loading, download, apply, sub } from './CTStore.js';\n  import UIItem from './UI/UIItem.html'\n    let selected_date = dayjs(), orders = [], account, outlet;\n    let tools = [{ name: \"Refresh\", icon: \"refresh\", function: \"refresh\" },\n  { name: \"Export\", icon: \"cloud-download\", function: \"export\" }]\n  function changeDate(day) {\n        selected_date = selected_date.add(day, 'day');\n        get_orders();\n    }\n    function get_orders() {\n        $loading = true;\n        let query = { dine_in : 'true', from: selected_date.startOf('day').toJSON(), to: selected_date.endOf('day').toJSON() };\n        if (account.franchise_id) {\n            query = { ...query, fran_id: account.franchise_id, outlet_id: outlet.id };\n        }\n        fetch(api(`/orders`), query, 'GET').then(data => {\n            $loading = false;\n            orders = data.orders;\n        });\n    }\n    function selected(e) {\n        switch (e.detail.function) {\n             case \"refresh\":\n                get_orders()\n                break;\n            case \"export\":\n                {\n                    let list = [];\n                    orders.forEach(order => {\n                        list = [...list, {\n                            'Date/Time' : dayjs(order.sentAt).format('YYYY-MM-DD HH:mm'),\n                            'Table' : order.table_id,\n                            'Name' : order.guest.name,\n                            'Phone' : order.guest.phone\n                        }]\n                    })\n                    download(Papa.unparse(list), 'guestbook.csv', 'text/csv;encoding:utf-8');\n                }\n                break;\n        }\n    }\n    onMount(async () => {\n        let o = await fetch(api('/accounts'));\n        account = o[0];\n        outlet = account.outlets.length > 0 ? account.outlets[0] : { id: \"\", name: \"Default\" };\n        get_orders();\n    });\n    \n</script>\n<style>\n    table td {\n        @apply p-2;\n    }\n</style>\n<Toolbar class=\"border-b border-gray-300\" on:selected=\"{selected}\" tools=\"{tools}\" />\n<div class=\"border-t border-b border-gray-200 flex\">\n    <div class=\"p-2 flex-none\">\n        <label class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\">\n            Outlet\n        </label>\n        {#if account}\n        <select class=\"text-xl my-2 w-48\" on:change=\"{ (e) => { outlet = account.outlets.find(o => ''+o.id == e.target.value); get_orders() } }\">\n            {#if account.outlets.length==0}\n            <option value=\"0\">Default</option>\n            {/if}\n            {#each account.outlets as outlet,i}\n            <option value=\"{''+outlet.id}\">{outlet.name}</option>\n            {/each}\n        </select>\n        {/if}\n  </div>\n</div>\n<div class=\"flex text-lg font-semibold m-2\">\n    <button on:click=\"{ () => changeDate(-1) }\"><i class=\"far fa-arrow-alt-circle-left\"></i></button>\n    <div class=\"flex-grow self-center text-center\">\n        {selected_date.format('ddd D/M/YY')}\n    </div>\n    <button on:click=\"{ () => changeDate(1) }\"><i class=\"far fa-arrow-alt-circle-right\"></i></button>\n</div>\n<div class=\"m-2\">\n    <table class=\"w-full\">\n        <tr class=\"bg-theme text-white rounded-lg\">\n            <td>Date/Time</td>\n            <td>Table</td>\n            <td>Name</td>\n            <td>Phone</td>\n        </tr>\n        {#if orders}\n        {#each orders as order}\n        <tr class=\"hover:bg-gray-200\">\n        <td>\n        {dayjs(order.sentAt).format('h:mmA')}\n        </td>\n        <td>\n        {order.table_id}\n        </td>\n        <td>\n        {order.guest.name}\n        </td>\n        <td>\n        {order.guest.phone}\n        </td>\n        </tr>\n        {/each}\n        {/if}\n    </table>\n</div>"],"names":["ctx","outlets","length","name","id","dayjs","sentAt","format","table_id","guest","phone","account","outlet","selected_date","orders","changeDate","day","add","get_orders","$loading","query","dine_in","from","startOf","toJSON","to","endOf","franchise_id","fran_id","outlet_id","fetch","api","then","data","onMount","o","icon","function","e","detail","list","forEach","order","Date/Time","Table","Name","Phone","download","Papa","unparse","find","target","value"],"mappings":"miBAwEyC,GAAxBA,KAAQC,QAAQC,cAGdF,KAAQC,6BAAbC,sQAH2B,GAAxBF,KAAQC,QAAQC,qEAGdF,KAAQC,gBAAbC,6HAAAA,4MAC8BF,KAAOG,oDAAvB,GAAGH,KAAOI,iEAAMJ,KAAOG,6BAAvB,GAAGH,KAAOI,2EAsBvBJ,0BAALE,wKAAKF,aAALE,qIAAAA,6EAGDG,EAAML,MAAMM,QAAQC,OAAO,cAG3BP,MAAMQ,cAGNR,MAAMS,MAAMN,UAGZH,MAAMS,MAAMC,wYATZL,EAAML,MAAMM,QAAQC,OAAO,iCAG3BP,MAAMQ,iCAGNR,MAAMS,MAAMN,6BAGZH,MAAMS,MAAMC,oGAzBZV,KAAcO,OAAO,8EArB6CP,yBAAnBA,YAM3CA,aA2BAA,u1CA3BAA,gFAeJA,KAAcO,OAAO,0BAYjBP,iRAxFiCW,EAASC,EAA/CC,EAAgBR,IAASS,cAGtBC,EAAWC,OACdH,EAAgBA,EAAcI,IAAID,EAAK,QACvCE,aAEKA,QACLC,GAAW,OACPC,GAAUC,QAAU,OAAQC,KAAMT,EAAcU,QAAQ,OAAOC,SAAUC,GAAIZ,EAAca,MAAM,OAAOF,UACxGb,EAAQgB,eACRP,MAAaA,EAAOQ,QAASjB,EAAQgB,aAAcE,UAAWjB,EAAOR,KAEzE0B,EAAMC,aAAgBX,EAAO,OAAOY,KAAKC,QACrCd,GAAW,OACXL,EAASmB,EAAKnB,UAwBtBoB,gBACQC,QAAUL,EAAMC,EAAI,kBACxBpB,EAAUwB,EAAE,QACZvB,EAASD,EAAQV,QAAQC,OAAS,EAAIS,EAAQV,QAAQ,IAAOG,GAAI,GAAID,KAAM,YAC3Ee,uBA1CWf,KAAM,UAAWiC,KAAM,UAAWC,SAAU,YAC3DlC,KAAM,SAAUiC,KAAM,iBAAkBC,SAAU,wBAgBhCC,UACNA,EAAEC,OAAOF,cACP,UACFnB,cAEC,cAEOsB,KACJ1B,EAAO2B,QAAQC,IACXF,MAAWA,GACPG,YAActC,EAAMqC,EAAMpC,QAAQC,OAAO,oBACzCqC,MAAUF,EAAMlC,SAChBqC,KAASH,EAAMjC,MAAMN,KACrB2C,MAAUJ,EAAMjC,MAAMC,UAG9BqC,EAASC,KAAKC,QAAQT,GAAO,gBAAiB,gCA4BVF,QAAQ1B,EAASD,EAAQV,QAAQiD,KAAKf,GAAK,GAAGA,EAAE/B,IAAMkC,EAAEa,OAAOC,QAAQlC,SAYjGH,GAAY,OAIZA,EAAW"}