{"version":3,"file":"Vendors-4214a197.js","sources":["../../src/VendorView.html","../../src/Vendors.html"],"sourcesContent":["<script>\n    import { onMount, afterUpdate } from 'svelte'\n    import Toolbar from './UI/UIToolbar.html'\n    import TextField from './UI/UITextField.html'\n    import ModalView from './UI/UIModalView.html'\n    import ProductSelectionView from './ProductSelectionView.html'\n    import Loading from './UI/UILoading.html'\n    import { session, api, alert, accounts, modal, apply, fetch, customers, pop_modal, s3 } from './CTStore.js';\n    let loading = false, tags, file, products = [];\n    export let vendor = {}, account = {};\n    let style = { body: 'screen-height', content: 'overflow-y-scroll scrolling-touch' }\n    let tool_style = { container: \"justify-end\" }\n    let tools = [{ name: \"Close\", icon: \"close-circle\", function: \"pop_modal\" },\n    { name: \"Save\", icon: \"checkmark-circle\", function: \"save\" }]\n    if (vendor.outlet_id != \"\") {\n        get_products().then(r => {\n            vendor.products = vendor.products;\n        })\n\n    }\n    function reset_outlet() {\n        vendor.products = [];\n        get_products();\n    }\n    async function get_products() {\n        loading = true;\n        let prods;\n        try {\n            prods = await fetch(`https://db.getorders.app/products.sl.${account.franchise_id}.${vendor.outlet_id}.json`);\n            if (Object.prototype.toString.call(prods) != '[object Array]') {\n                prods = undefined;\n            }\n            console.log(prods);\n        } catch {\n            console.log(\"S3 not found\");\n        }\n        if (!prods) {\n            prods = await fetch(api('/guest/products'), { fran_id: account.franchise_id, outlet_id: vendor.outlet_id }, \"GET\");\n        }\n        products = prods;\n        loading = false;\n        return products;\n    }\n    function selected(e) {\n        if (e.detail.function == 'pop_modal') {\n            pop_modal()\n        }\n        if (e.detail.function == 'save') {\n            loading = true;\n            fetch(api(`/vendor`), vendor).then(r => { $apply = { vendor: r }; pop_modal(); });\n        }\n    }\n    function prod_info(prod) {\n        return products.find(p => p.id == parseInt(prod.id)) || { name: \"-\" };\n    }\n    function edit_products() {\n        $modal = [...$modal, { selected_prods: vendor.products, products, view: ProductSelectionView }]\n    }\n    apply.subscribe(cb => {\n        if (cb.selected_prods) {\n            vendor.products = cb.selected_prods;\n            $apply = {};\n        }\n    })\n    let field_style = { container: 'w-1/2 mx-2' }\n</script>\n<style>\n    .sect {\n        @apply text-xl font-bold mt-3 mx-2;\n    }\n</style>\n<ModalView style=\"{{ content: 'overflow-y-scroll scrolling-touch' }}\">\n    <div slot=\"loader\">\n        {#if loading}\n  <Loading>\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n    {/if}\n  </div>\n  <div slot=\"title\" class=\"font-semibold text-xl text-gray-600 pb-3\">\n    { vendor._id ? 'Edit Vendor' : 'Create Vendor'}\n  </div>\n  <div slot=\"content\">\n    <div class=\"flex mb-2\">\n        <TextField style=\"{field_style}\" label=\"Vendor Name\" placeholder=\"Enter vendor name\" bind:value=\"{vendor.name}\" />\n        <TextField style=\"{field_style}\" prefix=\"+6\" label=\"Phone\" placeholder=\"012345678\" bind:value=\"{vendor.phone}\" />\n    </div>\n    <p class=\"sect text-theme\">\n        Business Details\n    </p>\n    <div class=\"flex mb-2\">\n        <TextField style=\"{field_style}\" label=\"Unit/Building No\" placeholder=\"\" bind:value=\"{vendor.unit_no}\" />\n        <TextField style=\"{field_style}\" label=\"Address\" placeholder=\"\" bind:value=\"{vendor.address}\" />\n    </div>\n    <div class=\"flex mb-2\">\n        <TextField style=\"{field_style}\" label=\"Postcode\" placeholder=\"\" bind:value=\"{vendor.postcode}\" />\n    </div>\n    <div class=\"flex mb-2\">\n        <TextField style=\"{field_style}\" label=\"Bank Branch\" placeholder=\"E.g : Maybank\" bind:value=\"{vendor.bank_type}\" />\n        <TextField style=\"{field_style}\" label=\"Bank Account\" placeholder=\"Account No\" bind:value=\"{vendor.bank_acc}\" />\n    </div>\n    <p class=\"sect text-theme\">\n        Vendor Products\n    </p>\n    <div class=\"m-2\">\n        <label class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\">Drop Point Outlet</label>\n        <select class=\"text-xl my-2 w-48\" bind:value=\"{vendor.outlet_id}\" on:change=\"{reset_outlet}\">\n            <option value=\"\">Select Outlet</option>\n            {#each account.outlets as outlet,i}\n            <option value=\"{''+outlet.id}\">{outlet.name}</option>\n            {/each}\n        </select>\n    <label class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\">Selected Products</label>\n    <div class=\"border rounded shadow-sm p-2 w-full flex cursor-pointer { products.length>0 ? '' : 'opacity-25' }\" on:click=\"{edit_products}\">\n        <div class=\"flex-grow\">\n            {#if vendor.products.length > 0}\n                    {#each vendor.products as prod}\n                    <span class=\"inline-block p-2 rounded-lg text-xs bg-theme text-white m-1\">{prod_info(prod).name}</span>\n                    {/each}\n                {:else}\n                    <p class=\"text-gray-500\">No products selected.</p>\n                {/if}\n            </div>\n            <i class=\"icon ion-md-expand text-gray-600 self-center\"></i>\n            </div> \n    </div>\n  </div>\n    <div slot=\"toolbar\">\n    <Toolbar on:selected=\"{selected}\" tools=\"{tools}\" style=\"{tool_style}\" />\n  </div>\n</ModalView>","<script>\n    import { onMount } from 'svelte';\n    import Toolbar from './UI/UIToolbar.html';\n    import Loading from './UI/UILoading.html';\n    import UIItem from './UI/UIItem.html';\n    import VendorView from './VendorView.html';\n    import { session, api, alert, apply, modal, fetch } from './CTStore.js';\n    let vendors, accounts, loading = false;\n    let style = { container: \"border-b border-gray-300\" }\n    let tools = [{ name: \"Create\", icon: \"add\", function: \"add\" }]\n    onMount(() => {\n        fetch(api('/vendor')).then(r => { vendors = r });\n        fetch(api('/accounts')).then(o => { accounts = o })\n    });\n    function inspect(vendor) {\n        $modal = [...$modal, { vendor, account: accounts[0], view: VendorView }]\n    }\n    function selected(e) {\n        if (e.detail.function == 'add') {\n            let vendor_schema = {\n                name: \"\",\n                phone: \"\",\n                address: \"\",\n                unit_no: \"\",\n                postcode: \"\",\n                products: [],\n                bank_type: \"\",\n                bank_acc: \"\",\n                notes: \"\",\n                outlet_id: \"\"\n            };\n            $modal = [...$modal, { vendor: { ...vendor_schema }, account: accounts[0], view: VendorView }]\n        }\n    }\n    function outlet(oid) {\n        return accounts[0].outlets.find(o => '' + o.id == oid) || { name: '-' };\n    }\n    apply.subscribe(cb => {\n        if (cb.vendor) {\n            let vendor = vendors.find(p => p._id == cb.vendor._id)\n            if (vendor) {\n                vendors = vendors.map(p => p._id == cb.vendor._id ? cb.vendor : p)\n            } else {\n                vendors = [...vendors, cb.vendor]\n            }\n            $apply = {};\n        }\n    });\n</script>\n<Toolbar style=\"{style}\" on:selected=\"{selected}\" tools=\"{tools}\" />\n{#if !vendors || !accounts || loading}\n<Loading type=\"h-64\">\n    <div slot=\"message\">\n      One Moment Please..\n    </div>\n  </Loading>\n{:else}\n<div class=\"flex p-3 text-gray-400 font-semibold uppercase text-xs\">\n    <div class=\"flex-grow\">Vendor Name</div>\n    <div class=\"flex-none w-20\">Products</div>\n    <div class=\"flex-none w-20\">Outlet</div>\n</div>\n{#each vendors as vendor}\n<UIItem>\n  <div class=\"flex w-full p-3\" on:click=\"{ () => { inspect(vendor) } }\">\n    <div class=\"flex-grow\">\n       {vendor.name}\n    </div>\n    <div class=\"flex-none w-20\">{vendor.products.length} items</div>\n    <div class=\"flex-none w-20 text-left\">\n        {outlet(vendor.outlet_id).name}\n    </div>\n  </div>\n</UIItem>\n{/each}\n{/if}"],"names":["ctx","_id","name","id","products","length","phone","unit_no","address","postcode","bank_type","bank_acc","outlets","outlet_id","content","loading","vendor","account","get_products","prods","fetch","franchise_id","Object","prototype","toString","call","undefined","console","log","api","fran_id","then","r","apply","subscribe","cb","selected_prods","$apply","container","icon","function","e","detail","pop_modal","prod","find","p","parseInt","$modal","view","ProductSelectionView","tags","file","body","vendors","accounts","inspect","VendorView","onMount","o","map","vendor_schema","notes","oid"],"mappings":"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"}